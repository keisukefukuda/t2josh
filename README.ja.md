9deg - A job submittion helper for TSUBAME2.0
=============================================

English version is [here](https://github.com/keisukefukuda/9deg/blob/master/README.md)

本プログラムは無保証です。
詳しいライセンスや使用条件については LICENSE ファイルを見てください。

本プログラムは、第三者が提供しているものであり，
東工大学術国際情報センターから提供されているものではありません。
本プログラムについての意見・要望・問い合わせを同センターに送らないように
お願いします。

要望・バグ報告等は twitter/@keisukefukuda または keisukefukuda_at_gmail.com 
までお送りください。

Introduction
------------

TSUBAME上でジョブを投入するためには、ジョブスクリプトを用意しt2subコマンドを
正しいオプションで呼び出す必要があります．これは大変面倒な作業です．

9degスクリプトはこの作業を自動化します．具体的には

 - シェルスクリプトを自動的に用意し、
 - プロセス数等の計算を自動的に行い、
 - コンパイル環境等を自動検出して切り替え

をします。--dry オプションを用いると、実際にジョブの投入は行われないので、
どのようなファイルとコマンドが生成されるのかを見ることができます。

Examples
--------

例を見てみましょう。

その前に、9degのプログラムにパスが通っている必要があります。
パスの通っているところに9degプログラムを置くか、パスを通す必要があります。
「パスを通す」方法については、例えばこちら
http://www.google.co.jp/#hl=ja&q=linux+PATH
が参考になると思います。

### 例: 普通の逐次プログラムを実行する

    $ 9deg -g t2g-yourgroup --dry ./a.out -n 1 2 3

この出力は下のようになります

     #!/bin/sh
     #----------------------------------------------
     # Generated by 9deg at 2011-12-27 18:57:46.481264
     # in directory /home0/usr1/00M00000/github/9deg
     # t2sub -q S -W group_list=t2g-yourgroup -l select=1 /home/usr1/00M00000/.9deg/111227185746_290.sh
     # /home/usr1/00M00000/.9deg/111227185746_290.sh
     cd ${PBS_O_WORKDIR}
     
     mpirun  -n 1 -hostfile ${PBS_NODEFILE} ./a.out 2 3
     
     #----------------------------------------------
     
     

#-----で囲まれた範囲が、生成された一時シェルスクリプトを示しています。
その中には、実行されるt2subコマンドもコメントとして含まれています。

"--" という記号が、9degへのオプションと実行すべきプログラム/オプション
を分離する役目を果たしています。"--"を使わずに、
$ 9deg -g t2g-yourgroup --dry "./a.out -n 1 2 3"
と書くこともできます。この場合、オプションの順番は自由です。
ここで、--dryコマンドを使用したので、実際には処理は一切行われずに、
生成されたスクリプトの内容とコマンドラインを見ることができます。

"-g" オプションで、あなたが所属するTSUBAMEグループを指定します。
ここでは、ダミーとして t2g-yourgroup という名前を指定したので、
"そんなグループは存在しない"と警告が出ています。

### 例: MPIプログラム実行する

    $ 9deg -n 8x4 -g t2g-yourgroup -q S --dry ./a.out

出力:

     #!/bin/sh
     #----------------------------------------------
     # Generated by 9deg at 2011-12-27 18:57:46.560470
     # in directory /home0/usr1/00M00000/github/9deg
     # t2sub -q S -W group_list=t2g-yourgroup -l select=4:mpiprocs=8:ncpus=8 /home/usr1/00M00000/.9deg/111227185746_80.sh
     # /home/usr1/00M00000/.9deg/111227185746_80.sh
     cd ${PBS_O_WORKDIR}
     
     mpirun  -n 32 -hostfile ${PBS_NODEFILE} ./a.out
     
     #----------------------------------------------
     
     

### 例: MPIでない、OpenMPプログラムを実行する

    $ 9deg --openmp=4 -g t2g-yourgroup -q S--dry  ./a.out

出力:

     #!/bin/sh
     #----------------------------------------------
     # Generated by 9deg at 2011-12-27 18:57:46.639975
     # in directory /home0/usr1/00M00000/github/9deg
     # t2sub -q S -W group_list=t2g-yourgroup -l select=1:ncpus=4 /home/usr1/00M00000/.9deg/111227185746_590.sh
     # /home/usr1/00M00000/.9deg/111227185746_590.sh
     cd ${PBS_O_WORKDIR}
     
     export OMP_NUM_THREADS=4
     
     ./a.out
     
     #----------------------------------------------
     
     

NOTE: -n オプションを使うと自動的にMPIプログラムであると判断されるため、MPIでないOpenMPプログラムを実行するためには'--openmp=N' オプションを使ってください。


### 例: MPIとOpenMPのハイブリッドプログラムを実行する

    $ 9deg -n 4x4x2 -g t2g-yourgroup -q S --dry ./a.out

出力:

     #!/bin/sh
     #----------------------------------------------
     # Generated by 9deg at 2011-12-27 18:57:46.722718
     # in directory /home0/usr1/00M00000/github/9deg
     # t2sub -q S -W group_list=t2g-yourgroup -l select=2:mpiprocs=4:ncpus=16 /home/usr1/00M00000/.9deg/111227185746_81.sh
     # /home/usr1/00M00000/.9deg/111227185746_81.sh
     cd ${PBS_O_WORKDIR}
     
     export OMP_NUM_THREADS=4
     
     mpirun -x OMP_NUM_THREADS -n 8 -hostfile ${PBS_NODEFILE} ./a.out
     
     #----------------------------------------------
     
     
