================================================================================
            tcpsub - A job submittion helper for TSUBAME2.0
================================================================================

WARNING:
    This is a 'third-party' program. Please do NOT contact Tokyo Tech GSIC
    support desk about this program.

    Please send a feature request or bug report to twitter/@keisukefukuda or
    keisukefukuda_at_gmail.com.

WARNING:
    This program is provided "as is", without any warranty.
    Please read LICENSE file before using.

=========== Introduction ===========

tcpsub is a job submission helper script for TSUBAME 2.0.
To submit a job on TSUBAME2.0, you have to:

 * prepare a shell script which includes environmental variable settings
 * call 't2sub' command with correct arguments, such as #node/#procs/#cups.

'tcpsub' does these chores for you, which include

 * preparing a shell script to be executed by t2sub
 * calculate # of processes/nodes/ncpus and set OpneMP evn vars
 * detect compilation environment(compiler and MPI library choice)


You can see what generated shell scripts and commands look like by using --dry option, which means 'dry run'.

=========== Examples ===========

Let's see some examples:

(1) Invoke a serial, normal program

$ tcpsub -g t2g-yourgroup --dry -- ./a.out -n 1 2 3
*** Warning: No such t2-group or you don't belong to 't2g-yourgroup'
#!/bin/sh
#----------------------------------------------
# Generated by tcpsub.py at 2011-06-09 19:55:24.051464
# in directory /home0/usr1/********/tcpsub
# t2sub -q S -W group_list=t2g-yourgroup -l ncpus=1 /home/usr1/********/.tcpsub/110609195524_50.sh
# /home/usr1/********/.tcpsub/110609195524_50.sh
cd ${PBS_O_WORKDIR}

export PATH=/usr/apps/openmpi/1.4.2/intel/bin:$PATH
export LD_LIBRARY_PATH=/usr/apps/openmpi/1.4.2/intel/lib:$LD_LIBRARY_PATH

./a.out -n 1 2 3

#----------------------------------------------

You can see the generated shell script and command line.
The line beginning with '$' is the command we input, followed by
output from tcpsub command.

Text between "#----" lines is content of the generated temporary shell script,
which includes generated t2sub command line as a comment.

'--' is used to separate arguments for tcpsub and program to be executed
with its arguments. You can also write like
$ tcpsub -g t2g-yourgroup --dry "./a.out -n 1 2 3"
without "--".

Since we used --dry option here, nothing is executed and we can observed
what tcpsub command was trying to do.

"-g" option is used to specify your TSUBAME group. There is a warning
that no such group as 't2g-yourgroup', which we used as a dummy group name.

S queue is used by default. You can change queue by using -q option.


*** Invoke an MPI program on 4 nodes, with 8 processes per node.

$ ./tcpsub.py -n 8x4 -g t2g-yourgroup -q S ./a.out --dry
*** Warning: No such t2-group or you don't belong to 't2g-yourgroup'
#!/bin/sh
#----------------------------------------------
# Generated by tcpsub.py at 2011-06-09 19:56:54.193265
# in directory /home0/usr1/********/tcpsub
# t2sub -q S -W group_list=t2g-yourgroup -l select=4:mpiprocs=8:ncpus=8 -l place=scatter /home/usr1/********/.tcpsub/110609195654_190.sh
# /home/usr1/********/.tcpsub/110609195654_190.sh
cd ${PBS_O_WORKDIR}

export PATH=/usr/apps/openmpi/1.4.2/intel/bin:$PATH
export LD_LIBRARY_PATH=/usr/apps/openmpi/1.4.2/intel/lib:$LD_LIBRARY_PATH

mpirun -n 32 -hostfile ${PBS_NODEFILE} ./a.out

#----------------------------------------------

***  Invoke non-MPI OpenMP program

$ ./tcpsub.py --openmp=4 -g t2g-yourgroup -q S ./a.out --dry
#!/bin/sh
#----------------------------------------------
# Generated by tcpsub.py at 2011-06-09 20:05:01.420576
# in directory /home0/usr1/*******/tcpsub
# t2sub -q S -W group_list=t2g-yourgroup -l ncpus=4 /home/usr1/******/.tcpsub/110609200501_340.sh
# /home/usr1/******/.tcpsub/110609200501_340.sh
cd ${PBS_O_WORKDIR}

export OMP_NUM_THREADS=4

export PATH=/usr/apps/openmpi/1.4.2/intel/bin:$PATH
export LD_LIBRARY_PATH=/usr/apps/openmpi/1.4.2/intel/lib:$LD_LIBRARY_PATH

./a.out

#----------------------------------------------

NOTE: -n options implies MPI, so if you want to run a non-MPI OpenMP program, you have to use '--openmp=N'.


***  Invoke an MPI & OpenMP hybrid program

$ ./tcpsub.py -n 4x4x2 -g t2g-yourgroup -q S ./a.out --dry
*** Warning: No such t2-group or you don't belong to 't2g-yourgroup'
#!/bin/sh
#----------------------------------------------
# Generated by tcpsub.py at 2011-06-09 20:06:19.435358
# in directory /home0/usr1/******/tcpsub
# t2sub -q S -W group_list=t2g-yourgroup -l select=2:mpiprocs=4:ncpus=16 -l place=scatter /home/usr1/******/.tcpsub/110609200619_340.sh
# /home/usr1/******/.tcpsub/110609200619_340.sh
cd ${PBS_O_WORKDIR}

export OMP_NUM_THREADS=4

export PATH=/usr/apps/openmpi/1.4.2/intel/bin:$PATH
export LD_LIBRARY_PATH=/usr/apps/openmpi/1.4.2/intel/lib:$LD_LIBRARY_PATH

mpirun -n 8 -hostfile ${PBS_NODEFILE} ./a.out

#----------------------------------------------
